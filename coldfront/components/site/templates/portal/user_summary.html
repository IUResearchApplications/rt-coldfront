{% load static %}
<div class="row">
  <div class="col">
    <div id="userCount" style="min-height: 270px; max-width: 519px;"></div>
  </div>
  <div class="col">
    <div id="userYearTimeline" style="min-height: 270px; max-width: 519px;"></div>
    <!-- <div id="userMonthTimeline" style="min-height: 270px; max-width: 519px;"></div> -->
  </div>
</div>

{{ user_counts|json_script:"user_counts" }}
{{ user_timeline|json_script:"user_timeline" }}
{{ years_to_months_labels|json_script:"years_to_months_labels" }}
{{ years_to_months_values|json_script:"years_to_months_values" }}

<script>
  var user_counts = JSON.parse(document.getElementById('user_counts').textContent);
  var user_timeline = JSON.parse(document.getElementById('user_timeline').textContent);
  var years_to_months_labels = JSON.parse(document.getElementById('years_to_months_labels').textContent);
  var years_to_months_values = JSON.parse(document.getElementById('years_to_months_values').textContent);

  var userYearTimelineChart;
  var userMonthTimelineChart;


  $(document).ready(function () {
    drawUserCount();
    userYearTimelineChart = generateUserYearTimeline();
    userMonthTimelineChart = generateUserMonthTimeline();
  });

  function drawUserCount() {
    var chart = c3.generate({
      bindto: '#userCount',
      data: user_counts,
      tooltip: {
        show: false
      },
      axis: {
        y: {
          label: 'Total Unique Users'
        },
      }
    })
  }

  function generateUserYearTimeline() {
    xLabel = user_timeline['columns'][0][0];
    data = {
      columns: user_timeline['columns'],
      x: user_timeline['x'],
      types: {
        xLabel: 'area-spline'
      },
      groups: [[xLabel]],
      onclick: function(obj) {
        year = obj.x.getFullYear()
        if (!(year in years_to_months_labels)) {
          return;
        }

        userMonthTimelineChart.load({
          unload: true,
          columns: [
            years_to_months_labels[year],
            years_to_months_values[year]
          ]
        });
      }
    }
    var chart = c3.generate({
      bindto: '#userYearTimeline',
      data: data,
      legend: {
        hide: true
      },
      axis: {
        x: {
          type: 'timeseries',
          padding: {
            right: 1500000000 // Timeseries graph treats this as milliseconds in the future to show
          },
          tick: {
            format: '%Y'
          },
          label: 'Year'
        },
        y: {
          padding: {
            bottom: 4
          },
          label: 'Total Unique Users'
        }
      }
    })

    return chart;
  }

  function generateUserMonthTimeline() {
    var chart = c3.generate({
      bindto: '#userMonthTimeline',
      data: {
        x: 'Months',
        columns: [
          years_to_months_labels[2022],
          years_to_months_values[2022]
        ]
      },
      legend: {
        item: {
          onclick: function (id) { }
        }
      },
      axis: {
        x: {
          type: 'timeseries',
          tick: {
            format: '%m',
            padding: {
              right: 100000000
            },
            culling: false
          },
          label: 'Month'
        },
        y: {
          padding: {
            bottom: 4
          },
          label: 'Total Unique Users'
        }
      }
    })

    return chart;
  }
</script>
