{% extends "common/base.html" %}
{% load common_tags %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %} Generate History Report {% endblock %}

{% block content %}
<h1>Generate a History Report</h1>
<hr />
<form id="post-form" action="/search-history" method="post">
  {% csrf_token %}
  {{ form|crispy }}
  <button type="submit" class="btn btn-primary">Generate</button>
</form>

<div id="history_report_results"></div>

<script>
  $("#navbar-main > ul > li.active").removeClass("active");
  $("#navbar-admin").addClass("active");

  $(document).ready(function () {
    $("#post-form").on("submit", function (event) {
      event.preventDefault();

      $.ajax({
        url: "{% url 'history-report-results' %}" + "?model=" + $('#id_id').val(),
        type: "GET",
        success: function (data) {
          $("#history_report_results").html(data);
        },
        error: function (xhr, errmsg, err) {
          if (xhr.status == 403 || xhr.status == 401) {
            $("#search_results_inner").html(
              "<div class='alert alert-danger'>Your session expired. Please login again. <a href='#' class='close'>&times;</a></div>",
            );
          } else {
            $("#search_results_inner").html(
              "<div class='alert alert-danger'>Oops! We have encountered an error: " +
                errmsg +
                " <a href='#' class='close'>&times;</a></div>",
            );
          }
        },
      });
    });
  });
</script>
{% endblock %}
